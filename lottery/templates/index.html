{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
  <title>MainsLott</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
  <style>
  body, h1, h2, h3, h4, h5, h6, td, span, label, input, select, button {
    font-family: "Times New Roman", serif !important;
  }
</style>
<style>
  .container,
  .container-fluid,
  .container-lg,
  .container-md,
  .container-sm,
  .container-xl,
  .container-xxl {
    padding-left: 0 !important;
    padding-right: 0 !important;
  }
</style>
  <style>  
  header {
    background-color: #f2f2f2;
    text-align: center;
  }
html, body {
  height: 100%;
  width: 100%;
  margin: 0;
  padding: 0;
  display: flex;
  flex-direction: column;
}
.wrapper {
  flex: 1;
}
footer {
  width: 100%;
  background-color: #f2f2f2;
  text-align: center;
  padding: 8px 0;
  font-weight: bold;
}
.head {
    text-align: center;
    margin: 0px auto;
    background-color: #FFA7DC;
    background-image: linear-gradient(to bottom right, #c494d8);
    padding-bottom: 5px;
}
td{
    text-align: -webkit-center;
    vertical-align: middle;
}
</style>
<style>
.table>:not(caption)>*>* {
    padding: 0.05rem 0.4rem !important; 
}
</style>
<style>
  #timeSelector {
    transition: all 0.3s ease;
  }
</style>
<style>
  /* Base (mobile-first) */
  .text-label {
    font-weight: 600;
  }
  .main-title {
    font-size: 30px !important;
    font-weight: bold;
  }

@media (min-width: 0px) and (max-width: 352px) {
#mainForm {
    flex-direction: column !important;
    align-items: stretch !important;
    gap: 4px !important;
    padding: 4px;
  }

  #mainForm .small-field {
    flex-direction: column !important;
    align-items: stretch !important;
    width: 100% !important;
  }

  #mainForm label {
    font-size: 10px !important;
    margin-bottom: 2px !important;
    font-weight: 600 !important;
  }

  #mainForm input,
  #mainForm select {
    width: 100% !important;
    font-size: 10px !important;
    padding: 4px !important;
  }

  #mainForm button {
    font-size: 10px !important;
    flex: 1 1 auto;
  }

  #mainForm .dropdown {
    width: 100% !important;
  }

  #mainForm .dropdown-toggle {
    width: 100% !important;
    text-align: center !important;
  }

  #timeSelector {
    padding: 4px !important;
  }
  marquee{
      font-size: smaller;
      margin: 0;
  padding: 0;
  line-height: 1;
  display: block;
    }
        .leftspace{
      margin-left: 10px;
    }
    .rightspace{
      margin-left: 10px;
    }
    .nodatafont{
      font-size: smaller;
    }
}
  @media screen and (max-width: 358px) {
    .smaller-mobile {
      gap: 0rem !important;
    }
    .head {
      text-align: center;
      margin: 0px auto;
      background-color: #FFA7DC;
      background-image: linear-gradient(to bottom right, #c494d8);
      padding-bottom: 5px;
    }
    .nextmargin{
      margin-right: 25px;
    }
    marquee{
      font-size: smaller;
      margin: 0;
  padding: 0;
  line-height: 1;
  display: block;
    }
        .leftspace{
      margin-left: 10px;
    }
    .rightspace{
      margin-left: 10px;
    }
    .nodatafont{
      font-size: smaller;
    }
  }

  @media (max-width: 336px) {
  .smaller-mobile {
    gap: 0 !important;
    justify-content: space-around !important;
    padding: 0 2px !important;
  }

  .smaller-mobile .text-label-mini {
    font-size: 9px !important;
    line-height: 1.1 !important;
  }

  .smaller-mobile .main-title-mini {
    font-size: 12px !important;
  }

  .smaller-mobile .btn-outline-primary {
    padding: 2px 5px !important;
  }

  .small-block {
    min-width: 32% !important;
  }
  .nextmargin{
      margin-right: 17px;
    }
  marquee{
      font-size: smaller;
      margin: 0;
  padding: 0;
  line-height: 1;
  display: block;
    }
        .leftspace{
      margin-left: 10px;
    }
    .rightspace{
      margin-left: 10px;
    }
    .nodatafont{
      font-size: smaller;
    }
}


  /* Mobile view ≤576px */
  @media screen and (max-width: 576px) {
    .text-label-mini {
      font-size: 10px;
      font-weight: 600;
      line-height: 1.2;
    }
    .main-title-mini {
      font-size: 18px;
      font-weight: bold;
    }
    .small-block {
      min-width: 30%;
      flex-shrink: 1;
    }
    .form-label,
    .form-control,
    .form-select,
    .btn-sm {
      font-size: 12px !important;
    }
    .small-field label {
      font-size: 12px !important;
    }
    .btn-sm {
      padding: 4px 10px !important;
    }
    #mainForm {
      font-size: 13px;
    }
    .nextmargin{
      margin-right: 6px;
    }
    marquee{
      font-size: smaller;
      margin: 0;
      padding: 0;
      line-height: 1;
      display: block;
    }
        .leftspace{
      margin-left: 10px;
    }
    .rightspace{
      margin-left: 10px;
    }
    .nodatafont{
      font-size: small;
    }
  }
  @media (max-width: 767px) {
  #mainForm {
    gap: 0.5rem !important;
  }
  #mainForm label,
  #mainForm input,
  #mainForm select,
  #mainForm button {
    font-size: 0.6rem !important;
  }
  #dateInput{
    font-weight: bold;
    width: 85px;
  }
  #timeInput{
    font-weight: bold;
    width: 65px;
  }
      .leftspace{
      margin-left: 10px;
    }
    .rightspace{
      margin-left: 10px;
    }
  .nodatafont{
      font-size: small;
    }
}
  /* NEW: Medium desktop (992–1400px) - Make it smaller to fit better */
  @media screen and (min-width: 992px) and (max-width: 1400px) {
    .text-label {
      font-size: 19px !important;
      font-weight: 600;
    }
    .main-title {
      font-size: 36px !important;
      font-weight: bold;
    }
    .btn-sm {
      font-size: 16px !important;
      padding: 5px 12px !important;
    }
    .form-label {
      font-size: 20px !important;
    }
    .form-control,
    .form-select {
      font-size: 16px !important;
    }
    marquee{
      font-size: larger;
      margin: 0;
      padding: 0;
      line-height: 1;
      display: block;
    }
    .leftspace{
      margin-left: 15px;
    }
    .rightspace{
      margin-left: 15px;
    }
    .nodatafont{
      font-size: larger;
    }
  }

  /* Large desktop ≥1401px - Keep your big style */
  @media screen and (min-width: 1401px) {
    .text-label {
      font-size: 30px !important;
      font-weight: 600;
    }
    .main-title {
      font-size: 50px !important;
      font-weight: bold;
    }
    .btn-sm {
      font-size: 18px !important;
      padding: 6px 14px !important;
    }
    .form-label {
      font-size: 25px !important;
    }
    .form-control,
    .form-select {
      font-size: 17px !important;
    }
    marquee{
      font-size: larger;
      margin: 0;
      padding: 0;
      line-height: 1;
      display: block;
    }
    .leftspace{
      margin-left: 15px;
    }
    .rightspace{
      margin-left: 15px;
    }
    .refresh-desktop-btn {
      border: none !important;
      color: black !important;
      background-color: transparent !important;
      margin-top: 5px;
    }
    .nodatafont{
      font-size: larger;
    }
  }
</style>
  <style>
  .result-cell {
    font-size: 10px;
    font-weight: bold;
    padding: 4px;
  }
  
  @media (min-width: 576px) {
    .result-cell {
      font-size: 22px;
      padding: 6px;
    }
    .result-heading{
    font-size: 30px;
    } 
  }
  @media (min-width: 992px) {
    .result-cell {
      font-size: 35px;
      padding: 8px;
    }
    .result-heading{
    font-size: 35px;
    } 
  }
</style>
<style>
  .main-title {
    margin: 0 !important;
    padding: 0 !important;
  }
  .timeHoverZone {
  padding-left: 0 !important;
  padding-right: 0 !important;
}
</style>
<style>
  select.no-caret {
    appearance: none;
    -webkit-appearance: none;
    -moz-appearance: none;
    background-image: none !important;
    padding-right: 10px; 
  }
  .dropdown-menu {
    max-width: 100vw;
    overflow-x: auto;
    font-size: 0.9rem;
  }
</style>
<style>
@media (max-width: 768px) {
  /* Force 5 columns per row on mobile (100% / 5 = 20%) */
  .mobile-col-20 {
    flex: 0 0 20% !important;
    max-width: 20% !important;
  }

  #chartbuttons button {
    font-size: 0.8rem;
    padding: 0.3rem 0.5rem;
  }

  .refresh-mobile-btn {
    border: none !important;
    color: black !important;
    background-color: transparent !important;
    margin-top: 2px;
  }
}
</style>
</head>
<body>

<div class="container-fluid">
  <marquee behavior="" direction="">
    Note :- All the information here is based on Numeric astrology is not related to any type of gambling. Viewing this website is on your own risk. We are not responsible for any issue or scam. We respect all country rules and laws. If you not agree with our site, please quit our site right now..!!
  </marquee>
  <div class="head container-fluid bg-light " >
    <!-- desktop view -->
    <div class="row align-items-center text-center d-none d-lg-flex">
      <div class="col-md-5 d-flex justify-content-start align-items-center" style="font-weight: 600;">
        <div class="text-label me-4 leftspace">Time: <span class="currentTime">--:--:--</span></div>
        <div class="text-label">Date: <span>{{ formatted_date }}</span></div>
      </div>
      <div class="timeHoverZone col-md-2 d-flex justify-content-center align-items-center px-0">
        <strong class="main-title">MainsLott</strong> &nbsp;
        <button type="button" class="btn btn-outline-primary p-1 refresh-desktop-btn" onclick="window.location.href = window.location.href;" title="Refresh">
          <i class="bi bi-arrow-clockwise" style="font-size: 45px;"></i>
        </button>
      </div>
      <div class="col-md-5 d-flex justify-content-end align-items-center" style="font-weight: 600;">
        <div class="text-label me-4 drawtime">Draw Time: 
          {% if show_history == "4" %}
            All Times
          {% else %}
            {{ selected_time_display }}
          {% endif %}
          </div>
        <div class="text-label me-4 rightspace">Next Draw: <span class="nextDraw">--:--:--</span></div>
        <input type="hidden" class="nextDrawTime" value="{{ next_draw_time_str }}">
        <input type="hidden" class="autoRefreshTime" value="{{ auto_refresh_time_str }}">
      </div>
    </div>
    <!-- mobile view -->
    <div class="d-flex d-lg-none flex-row flex-wrap justify-content-between align-items-center text-center gap-2 smaller-mobile">
      <div class="d-flex flex-column align-items-start small-block" style="font-weight: 600;">
        <div class="text-label-mini ">Time: <span class="currentTime ">--:--:--</span></div>
        <div class="text-label-mini ">Date: <span>{{ formatted_date }}</span></div>
      </div>
      <div class="d-flex flex-row align-items-center gap-1 small-block" style="font-weight: 600;">
        <strong class="timeHoverZone main-title-mini">MainsLott</strong>
        <button type="button" class="btn btn-outline-primary p-1 refresh-mobile-btn" onclick="window.location.href = window.location.href;" title="Refresh">
          <i class="bi bi-arrow-clockwise" style="font-size: 15px;"></i>
        </button>
      </div>
      <div class="d-flex flex-column align-items-end small-block" style="font-weight: 600;">
        <div class="text-label-mini drawtime ">Draw Time: 
          {% if show_history == "4" %}
            All Times
          {% else %}
            {{ selected_time_display }}
          {% endif %}
        </div>
        <div class="text-label-mini nextmargin " >Next Draw: <span class="nextDraw">--:--:--</span></div>
        <input type="hidden" class="nextDrawTime" value="{{ next_draw_time_str }}">
        <input type="hidden" class="autoRefreshTime" value="{{ auto_refresh_time_str }}">
      </div>
    </div>
    <section id="timeSelector">
      <form method="post" id="mainForm" 
            class="d-flex flex-column flex-md-row align-items-center justify-content-center gap-2">
        {% csrf_token %}

        <!-- Date and Time (always together) -->
        <div class="d-flex flex-wrap align-items-center justify-content-center gap-2">
          <div class="d-flex align-items-center gap-1">
            <label class="form-label mb-0" for="dateInput" style="font-size: 0.9rem;"><strong>Date:</strong></label>
            <input type="date" id="dateInput" name="date" value="{{ selected_date }}" style="font-weight: 600;"
                  class="autoSubmit form-control form-control-sm">
          </div>

          <div class="d-flex align-items-center gap-1">
            <label class="form-label mb-0" for="timeInput" style="font-size: 0.9rem;"><strong>Time:</strong></label>
            <select name="time" id="timeInput"
                    class="selecttime autoSubmit form-select form-select-sm no-caret" style="font-weight: 600;"
                    onchange="setMode()">
                <option value="" {% if not selected_time and show_history != '4' %}selected{% endif %}>All Times</option>
                {% for slot in time_slots %}
                  {% if selected_date == today_string %}
                    {% with slot_time=slot|time:"H:i" %}
                      {% if slot_time <= current_time %}
                        <option value="{{ slot }}" {% if slot == selected_time and show_history != '4' %}selected{% endif %}>{{ slot }}</option>
                      {% endif %}
                    {% endwith %}
                  {% else %}
                    <option value="{{ slot }}" {% if slot == selected_time and show_history != '4' %}selected{% endif %}>{{ slot }}</option>
                  {% endif %}
                {% endfor %}
            </select>
          </div>
        </div>

        <!-- Buttons (appear below on mobile, same line on desktop) -->
        <div class="d-flex flex-wrap justify-content-center gap-2">
          <button type="button" class="btn btn-success btn-sm" id="btnSingle" style="font-size: 0.85rem;">SINGLE</button>
          <button type="button" class="btn btn-success btn-sm" id="btnTwo" style="font-size: 0.85rem;">TWO</button>
          <button type="button" class="btn btn-success btn-sm" id="btnFull" style="font-size: 0.85rem;">FULL</button>

          <div class="dropdown">
            <button class="btn btn-success btn-sm dropdown-toggle" id="btnHistory"
                    type="button" data-bs-toggle="dropdown" aria-expanded="false"
                    style="font-size: 0.85rem;">
              HISTORY
            </button>
            <ul class="dropdown-menu dropdown-menu-end">
              <li><button class="dropdown-item" type="button" onclick="setHistoryModeAndSubmit('single')">SINGLE</button></li>
              <li><button class="dropdown-item" type="button" onclick="setHistoryModeAndSubmit('two')">TWO</button></li>
              <li><button class="dropdown-item" type="button" onclick="setHistoryModeAndSubmit('full')">FULL</button></li>
              <li><button class="dropdown-item" type="button" onclick="setHistoryModeAndSubmit('chart')">CHART</button></li>
            </ul>
          </div>
        </div>

        <input type="hidden" name="show_history" id="show_history_input" value="{{ show_history|default:'4' }}">
        <input type="hidden" name="history_mode" id="history_mode_input" value="{{ history_mode|default:'full' }}">
      </form>
    </section>
  </div>
    {% if show_history == "1" or show_history == "2" %}
    <div  id="resultArea">
      <table class="table table-bordered text-center" style="font-weight:bold;border: 1px solid black;">
        <thead>
          <tr>
            <th class="result-cell" style="background-color: #131a3e;color: white;border: 1px solid white;"></th>
            {% for col in column_headers|slice:":10" %}
              <th class="result-cell" style="background-color: #131a3e !important;color: white !important;border: 1px solid white !important;">{{ col }}</th>
            {% endfor %}
          </tr>
        </thead>
        <tbody>
          {% for row in grid|slice:":10" %}
            <tr class="result-cell" style="background-color: #131a3e !important;color: white !important;border: 1px solid white !important;">
              <th class="result-cell" style="background-color: #131a3e !important;color: white !important;border: 1px solid white !important;">
                  {{ forloop.counter0|add:forloop.counter0|add:forloop.counter0|add:forloop.counter0|add:forloop.counter0|add:forloop.counter0|add:forloop.counter0|add:forloop.counter0|add:forloop.counter0|add:forloop.counter0|stringformat:"02d" }}
              </th>
              {% for cell in row %}
                {% if forloop.counter0 == 0 %}
                  <td class="result-cell" style="background-color:#FFEB3B; font-weight:bold;" align="center">
                {% elif forloop.counter0 == 1 %}
                  <td class="result-cell" style="background-color:#ecd4d8; font-weight:bold;" align="center">
                {% elif forloop.counter0 == 2 %}
                  <td class="result-cell" style="background-color:#85d825; font-weight:bold;" align="center">
                {% elif forloop.counter0 == 3 %}
                  <td class="result-cell" style="background-color:#ea8d9e; font-weight:bold;" align="center">
                {% elif forloop.counter0 == 4 %}
                  <td class="result-cell" style="background-color:#e3a0ef; font-weight:bold;" align="center">
                {% elif forloop.counter0 == 5 %}
                  <td class="result-cell" style="background-color:#d47c8c; font-weight:bold;" align="center">
                {% elif forloop.counter0 == 6 %}
                  <td class="result-cell" style="background-color:#ecd4d8; font-weight:bold;" align="center">
                {% elif forloop.counter0 == 7 %}
                  <td class="result-cell" style="background-color:#FFEB3B; font-weight:bold;" align="center">
                {% elif forloop.counter0 == 8 %}
                  <td class="result-cell" style="background-color:#5bbfec; font-weight:bold;" align="center">
                {% elif forloop.counter0 == 9 %}
                  <td class="result-cell" style="background-color:#ffa7dc; font-weight:bold;" align="center">
                {% else %}
                  <td>
                {% endif %}
                  {{ cell|default:"--" }}
                  </td>
              {% endfor %}
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    {% elif show_history == "4" %}
      <!-- history results -->
      {% if history_mode == "full" %}
        <div id="historyTable" >
          {% if history_data %}
            {% for slot, rows in history_data %}
                <div class="result-heading d-flex justify-content-between align-items-center px-2" style=" font-weight: bold;">
                  <div>MainsLott</div>
                  <div>{{ slot }}</div>
                  <div>{{ selected_date_display }}</div>
                </div>
              <table class="table table-bordered text-center" cellspacing="0" border="2" style="border-collapse:collapse; margin:0 auto;border: 1px solid black;">
                <tbody>
                  {% for row in rows %}
                    <tr>
                      {% for cell in row %}
                        {% if forloop.counter0 == 0 %}
                      <td class="result-cell" style="background-color:#FFEB3B; font-weight:bold;" align="center">
                    {% elif forloop.counter0 == 1 %}
                      <td class="result-cell" style="background-color:#ecd4d8; font-weight:bold;" align="center">
                    {% elif forloop.counter0 == 2 %}
                      <td class="result-cell" style="background-color:#85d825; font-weight:bold;" align="center">
                    {% elif forloop.counter0 == 3 %}
                      <td class="result-cell" style="background-color:#ea8d9e; font-weight:bold;" align="center">
                    {% elif forloop.counter0 == 4 %}
                      <td class="result-cell" style="background-color:#e3a0ef; font-weight:bold;" align="center">
                    {% elif forloop.counter0 == 5 %}
                      <td class="result-cell" style="background-color:#d47c8c; font-weight:bold;" align="center">
                    {% elif forloop.counter0 == 6 %}
                      <td class="result-cell" style="background-color:#ecd4d8; font-weight:bold;" align="center">
                    {% elif forloop.counter0 == 7 %}
                      <td class="result-cell" style="background-color:#FFEB3B; font-weight:bold;" align="center">
                    {% elif forloop.counter0 == 8 %}
                      <td class="result-cell" style="background-color:#5bbfec; font-weight:bold;" align="center">
                    {% elif forloop.counter0 == 9 %}
                      <td class="result-cell" style="background-color:#ffa7dc; font-weight:bold;" align="center">
                    {% else %}
                      <td>
                    {% endif %}
                      {{ cell.number|default:"--" }}
                    </td>
                      {% endfor %}
                    </tr>
                  {% endfor %}
                </tbody>
              </table>
            {% endfor %}
          {% endif %}
        </div>
        {% elif history_mode == "chart" %}
          <div id="chartbuttons" class="container chart_table my-3">
            <form method="post" id="chartForm">
              {% csrf_token %}
              <input type="hidden" name="history_mode" value="chart" />
              <div class="row g-2 justify-content-center">
                {% for i in "0123456789"|make_list %}
                  <div class="col-4 col-sm-3 col-md-2 col-lg-1 d-flex justify-content-center mobile-col-20">
                    <button type="submit" name="chart_prefix" value="{{ i }}0" class="btn btn-warning w-100">
                      {{ i }}0
                    </button>
                  </div>
                {% endfor %}
              </div>
            </form>
          </div>
          <div class="table-responsive">
          <table class="table table-bordered text-center">
            <thead>
              <tr>
                <th class="result-cell" style="background-color: #131a3e;color: white;border: 1px solid white;">TIME</th>
                {% for i in "0123456789"|make_list %}
                  <th class="result-cell" style="background-color: #131a3e;color: white;border: 1px solid white;">
                    {{ selected_chart_prefix|add:i }}
                  </th>
                {% endfor %}
              </tr>
            </thead>
            <tbody style="border: 1px solid black;">
              {% for time_label, row in chart_data %}
                <tr>
                  <td class="result-cell" style="background-color: #131a3e;color: white;border: 1px solid white;">
                    {{ time_label }}
                  </td>
                  {% for value in row %}
                    {% if forloop.counter0 == 0 %}
                  <td class="result-cell" style="background-color:#FFEB3B; font-weight:bold;" align="center">{{ value|default:"--" }}</td>
                {% elif forloop.counter0 == 1 %}
                  <td class="result-cell" style="background-color:#ecd4d8; font-weight:bold;" align="center">{{ value|default:"--" }}</td>
                {% elif forloop.counter0 == 2 %}
                  <td class="result-cell" style="background-color:#85d825; font-weight:bold;" align="center">{{ value|default:"--" }}</td>
                {% elif forloop.counter0 == 3 %}
                  <td class="result-cell" style="background-color:#ea8d9e; font-weight:bold;" align="center">{{ value|default:"--" }}</td>
                {% elif forloop.counter0 == 4 %}
                  <td class="result-cell" style="background-color:#e3a0ef; font-weight:bold;" align="center">{{ value|default:"--" }}</td>
                {% elif forloop.counter0 == 5 %}
                  <td class="result-cell" style="background-color:#d47c8c; font-weight:bold;" align="center">{{ value|default:"--" }}</td>
                {% elif forloop.counter0 == 6 %}
                  <td class="result-cell" style="background-color:#ecd4d8; font-weight:bold;" align="center">{{ value|default:"--" }}</td>
                {% elif forloop.counter0 == 7 %}
                  <td class="result-cell" style="background-color:#FFEB3B; font-weight:bold;" align="center">{{ value|default:"--" }}</td>
                {% elif forloop.counter0 == 8 %}
                  <td class="result-cell" style="background-color:#5bbfec; font-weight:bold;" align="center">{{ value|default:"--" }}</td>
                {% elif forloop.counter0 == 9 %}
                  <td class="result-cell" style="background-color:#ffa7dc; font-weight:bold;" align="center">{{ value|default:"--" }}</td>
                {% else %}
                  <td>{{ value|default:"--" }}</td>
                {% endif %}
                  {% endfor %}
                </tr>
              {% endfor %}
            </tbody>
          </table>
        {% else %}
        <!-- single & two historydata -->
        {% for label, grid in history_data %}
            <div class="result-heading d-flex justify-content-between align-items-center px-2" style=" font-weight: bold;">
              <div>MainsLott</div>
              <div>{{ label }}</div>
              <div>{{ selected_date_display }}</div>
            </div>
              <table class="result-cell table table-bordered text-center" style="margin-bottom: 0px;font-weight:bold;border: 1px solid black;">
                <thead class="result-cell" style="background-color: #131a3e;color: white;border: 1px solid white;">
                  <tr>
                    <th class="result-cell" style="background-color: #131a3e;color: white;border: 1px solid white;"></th>
                    {% for col in column_headers|slice:":10" %}
                      <th class="result-cell" style="background-color: #131a3e;color: white;border: 1px solid white;">{{ col }}</th>
                    {% endfor %}
                  </tr>
                </thead>
                <tbody>
                  {% for row in grid|slice:":10" %}
                    <tr>
                      <th style="background-color: #131a3e;color: white;border: 1px solid white;">
                        {{ forloop.counter0|add:forloop.counter0|add:forloop.counter0|add:forloop.counter0|add:forloop.counter0|add:forloop.counter0|add:forloop.counter0|add:forloop.counter0|add:forloop.counter0|add:forloop.counter0|stringformat:"02d" }}
                      </th>
                      {% for cell in row %}
                        {% if forloop.counter0 == 0 %}
                          <td class="result-cell" style="background-color:#FFEB3B; font-weight:bold;" align="center">
                        {% elif forloop.counter0 == 1 %}
                          <td class="result-cell" style="background-color:#ecd4d8; font-weight:bold;" align="center">
                        {% elif forloop.counter0 == 2 %}
                          <td class="result-cell" style="background-color:#85d825; font-weight:bold;" align="center">
                        {% elif forloop.counter0 == 3 %}
                          <td class="result-cell" style="background-color:#ea8d9e; font-weight:bold;" align="center">
                        {% elif forloop.counter0 == 4 %}
                          <td class="result-cell" style="background-color:#e3a0ef; font-weight:bold;" align="center">
                        {% elif forloop.counter0 == 5 %}
                          <td class="result-cell" style="background-color:#d47c8c; font-weight:bold;" align="center">
                        {% elif forloop.counter0 == 6 %}
                          <td class="result-cell" style="background-color:#ecd4d8; font-weight:bold;" align="center">
                        {% elif forloop.counter0 == 7 %}
                          <td class="result-cell" style="background-color:#FFEB3B; font-weight:bold;" align="center">
                        {% elif forloop.counter0 == 8 %}
                          <td class="result-cell" style="background-color:#5bbfec; font-weight:bold;" align="center">
                        {% elif forloop.counter0 == 9 %}
                          <td class="result-cell" style="background-color:#ffa7dc; font-weight:bold;" align="center">
                        {% else %}
                        {% endif %}
                          {{ cell|default:"--" }}
                          </td>
                      {% endfor %}
                    </tr>
                  {% endfor %}
                </tbody>
              </table>
          {% endfor %}
      {% endif %}
    {% else %}
      <!-- Full table button -->
      <div id="fullTable" >
        <table class="table table-bordered text-center" cellspacing="0" rules="all" border="1" id="GridView1" style="border-collapse:collapse;margin:0 auto;border: 1px solid black;">
          {% if results_exist %}
            {% for row in grid %}
              <tr>
                {% for cell in row %}
                  {% if forloop.counter0 == 0 %}
              <td class="result-cell" style="background-color:#FFEB3B; font-weight:bold;" align="center">{{ cell.number|default:"--" }}</td>
            {% elif forloop.counter0 == 1 %}
              <td class="result-cell" style="background-color:#ecd4d8; font-weight:bold;" align="center">{{ cell.number|default:"--" }}</td>
            {% elif forloop.counter0 == 2 %}
              <td class="result-cell" style="background-color:#85d825; font-weight:bold;" align="center">{{ cell.number|default:"--" }}</td>
            {% elif forloop.counter0 == 3 %}
              <td class="result-cell" style="background-color:#ea8d9e; font-weight:bold;" align="center">{{ cell.number|default:"--" }}</td>
            {% elif forloop.counter0 == 4 %}
              <td class="result-cell" style="background-color:#e3a0ef; font-weight:bold;" align="center">{{ cell.number|default:"--" }}</td>
            {% elif forloop.counter0 == 5 %}
              <td class="result-cell" style="background-color:#d47c8c; font-weight:bold;" align="center">{{ cell.number|default:"--" }}</td>
            {% elif forloop.counter0 == 6 %}
              <td class="result-cell" style="background-color:#ecd4d8; font-weight:bold;" align="center">{{ cell.number|default:"--" }}</td>
            {% elif forloop.counter0 == 7 %}
              <td class="result-cell" style="background-color:#FFEB3B; font-weight:bold;" align="center">{{ cell.number|default:"--" }}</td>
            {% elif forloop.counter0 == 8 %}
              <td class="result-cell" style="background-color:#5bbfec; font-weight:bold;" align="center">{{ cell.number|default:"--" }}</td>
            {% elif forloop.counter0 == 9 %}
              <td class="result-cell" style="background-color:#ffa7dc; font-weight:bold;" align="center">{{ cell.number|default:"--" }}</td>
            {% endif %}
                {% endfor %}
              </tr>
            {% endfor %}
            {% else %}
            <tr>
              <td colspan="10" class="nodatafont" style="font-weight: bold; padding: 30px;">
                No Record Found...!
              </td>
            </tr>
          {% endif %}
        </table>
    </div>
    {% endif %}
</div>
<script>
  window.userSelectedTime = "{{ selected_time|escapejs }}";
</script>
<script>
document.addEventListener("DOMContentLoaded", function () {
  const nextDrawEls = document.querySelectorAll(".nextDraw");
  const currentTimeEls = document.querySelectorAll(".currentTime");
  const drawTimeSpans = document.querySelectorAll(".drawtime span");
  const selectTimeSelects = document.querySelectorAll(".selecttime");

  function pad(num) {
    return String(num).padStart(2, '0');
  }

  function formatAMPM(date) {
    let hours = date.getHours();
    const minutes = date.getMinutes();
    const ampm = hours >= 12 ? 'PM' : 'AM';
    hours = hours % 12;
    if (hours === 0) hours = 12;
    return `${pad(hours)}:${pad(minutes)} ${ampm}`;
  }

  function updateCountdown() {
  const now = new Date();

  // Live Clock
  currentTimeEls.forEach(el => {
    let hours = now.getHours();
    const minutes = now.getMinutes();
    const seconds = now.getSeconds();
    const ampm = hours >= 12 ? "PM" : "AM";
    hours = hours % 12;
    if (hours === 0) hours = 12;
    el.textContent = `${pad(hours)}:${pad(minutes)}:${pad(seconds)} ${ampm}`;
  });

  // Define 9:00 AM and 9:30 PM today
  const drawStart = new Date(now);
  drawStart.setHours(9, 0, 0, 0);

  const drawEnd = new Date(now);
  drawEnd.setHours(21, 30, 0, 0);

  let nextDraw;

  if (now < drawStart) {
    // Before 9:00 AM – Next draw is at 9:00 AM
    nextDraw = new Date(drawStart);
  } else if (now > drawEnd) {
    // After 9:30 PM – Next draw is at 9:00 AM tomorrow
    nextDraw = new Date(now);
    nextDraw.setDate(now.getDate() + 1);
    nextDraw.setHours(9, 0, 0, 0);
  } else {
    // Within draw period (9:00 AM - 9:30 PM) – normal 15-min logic
    nextDraw = new Date(now);
    nextDraw.setSeconds(0, 0);
    nextDraw.setMinutes(Math.ceil(now.getMinutes() / 15) * 15);
    if (nextDraw <= now) {
      nextDraw.setMinutes(nextDraw.getMinutes() + 15);
    }
  }

  // Auto-update Draw Time slot (used elsewhere)
  let drawTime = new Date(now);
  drawTime.setSeconds(0, 0);

  if ((now.getMinutes() % 15 === 0) && (now.getSeconds() < 30)) {
    drawTime.setMinutes(Math.floor((now.getMinutes() - 15) / 15) * 15);
  } else {
    drawTime.setMinutes(Math.floor(now.getMinutes() / 15) * 15);
  }

  if (!window.userSelectedTime) {
    drawTimeSpans.forEach(el => {
      el.textContent = formatAMPM(drawTime);
    });

    selectTimeSelects.forEach(select => {
      for (let i = 0; i < select.options.length; i++) {
        const option = select.options[i];
        if (option.value === formatAMPM(drawTime)) {
          option.selected = true;
          break;
        }
      }
    });
  }

  // Countdown to nextDraw
  let diffSeconds = Math.floor((nextDraw - now) / 1000);
  if (diffSeconds < 0) diffSeconds = 0;

  const hours = now.getHours();
  const isWithinDrawTime = hours >= 9 && (hours < 21 || (hours === 21 && now.getMinutes() <= 30));

  nextDrawEls.forEach(el => {
    if (isWithinDrawTime) {
      // Show MM:SS format
      const mm = pad(Math.floor(diffSeconds / 60));
      const ss = pad(diffSeconds % 60);
      el.textContent = `${mm}:${ss}`;
    } else {
      // Show HH:MM:SS format
      const hh = pad(Math.floor(diffSeconds / 3600));
      const mm = pad(Math.floor((diffSeconds % 3600) / 60));
      const ss = pad(diffSeconds % 60);
      el.textContent = `${hh}:${mm}:${ss}`;
    }
  });

  // Optional reload at 29 seconds into each 15-minute slot
  if (now.getMinutes() % 15 === 0 && now.getSeconds() === 29 &&
      now >= drawStart && now <= drawEnd) {
    window.location.reload(true);
  }
}

  setInterval(updateCountdown, 1000);
  updateCountdown();
});
</script>
<script>
function setHistoryModeAndSubmit(mode) {
  document.getElementById('history_mode_input').value = mode;
  document.getElementById('mainForm').submit();
}
function setResultsModeAndSubmit(mode) {
  document.getElementById('results_mode_input').value = mode;
  document.getElementById('mainForm').submit();
}
document.getElementById("btnSingle").onclick = function () {
  document.getElementById("show_history_input").value = "1";
  document.getElementById("history_mode_input").value = ""; 
  document.getElementById("mainForm").submit();
};
document.getElementById("btnTwo").onclick = function () {
  document.getElementById("show_history_input").value = "2";
  document.getElementById("history_mode_input").value = "";
  document.getElementById("mainForm").submit();
};
document.getElementById("btnFull").onclick = function () {
  document.getElementById("show_history_input").value = "3";
  document.getElementById("history_mode_input").value = "";
  document.getElementById("mainForm").submit();
};
function setHistoryModeAndSubmit(mode) {
  document.getElementById('show_history_input').value = "4";  
  document.getElementById('history_mode_input').value = mode;
  document.getElementById('mainForm').submit();
}
</script>
<script>
function setMode() {
  const timeInput = document.getElementById("timeInput");
  const modeInput = document.getElementById("modeInput");
  if (timeInput.value === "") {
    if (!modeInput.value) {
      modeInput.value = "full";
    }
  } else {
    if (!modeInput.value) {
      modeInput.value = "full";  
    }
  }
}
</script>
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const buttons = document.querySelectorAll(".chartbutton");
    buttons.forEach(button => {
      button.addEventListener("click", function () {
        const start = parseInt(this.dataset.chartNumber);
        const end = start + 10;
        for (let col = 0; col < 10; col++) {
          const show = (col >= start / 10 && col < end / 10);
          const headerCell = document.querySelector(`.chart-column.chart${col}`);
          if (headerCell) {
            headerCell.style.display = show ? "table-cell" : "none";
          }
          const bodyCells = document.querySelectorAll(`.chart-column.valuetd.chart${col}`);
          bodyCells.forEach(cell => {
            cell.style.display = show ? "table-cell" : "none";
          });
        }
      });
    });
  });
</script>
<script>
  window.addEventListener('load', function () {
    // Only auto-submit if it's a fresh page load (not from history or a back button)
    if (!window.performance || window.performance.navigation.type === 1) {
      // Set FULL mode explicitly (if not already in context)
      document.getElementById('show_history_input').value = '3';
      document.getElementById('history_mode_input').value = '';
      document.getElementById('mainForm').submit();
    }
  });
</script> 
<script>
document.addEventListener("DOMContentLoaded", function () {
  const showHistory = "{{ show_history }}";
  const timeSelector = document.getElementById("timeSelector");
  const isMobile = window.innerWidth <= 768;
  if (showHistory === "3") {
    timeSelector.style.display = "none";
    const hoverZones = document.querySelectorAll(".timeHoverZone");

    hoverZones.forEach((zone) => {
      if (isMobile) {
        zone.addEventListener("click", () => {
          timeSelector.style.display =
            timeSelector.style.display === "block" ? "none" : "block";
        });
      } else {
        zone.addEventListener("mouseenter", () => {
          timeSelector.style.display = "block";
        });
        timeSelector.addEventListener("mouseleave", () => {
          timeSelector.style.display = "none";
        });
      }
    });
  } else {
    timeSelector.style.display = "block";
  }
});
</script>
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const dateInput = document.getElementById("dateInput");
    const timeInput = document.getElementById("timeInput");

    dateInput.addEventListener("change", function () {
      document.getElementById("mainForm").submit();
    });

    timeInput.addEventListener("change", function () {
      document.getElementById("mainForm").submit();
    });
  });
</script>
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const autoInputs = document.querySelectorAll(".autoSubmit");

    autoInputs.forEach((element) => {
      element.addEventListener("change", function () {
        if (element.id === "timeInput") {
          setMode(); 
        }
        document.getElementById("mainForm").submit();
      });
    });
  });
</script>
<!-- <script>
let nextDrawTimeStr = document.querySelector(".nextDrawTime").value;
function showBlackScreen() {
  const overlay = document.createElement('div');
  overlay.style.position = "fixed";
  overlay.style.top = 0;
  overlay.style.left = 0;
  overlay.style.width = "100vw";
  overlay.style.height = "100vh";
  overlay.style.backgroundColor = "black";
  overlay.style.opacity = "1";
  overlay.style.zIndex = "9999";
  document.body.appendChild(overlay);
  setTimeout(() => {
    overlay.style.transition = "opacity 1s";
    overlay.style.opacity = "0";
    setTimeout(() => overlay.remove(), 1000);
  }, 2000);
}

function updateCountdown(newSeconds) {
  const countdown = document.querySelector(".nextDraw");
  if (countdown) {
    let minutes = Math.floor(newSeconds / 60);
    let seconds = newSeconds % 60;
    countdown.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
  }
}

async function pollNextDrawTime() {
  try {
    const response = await fetch("{% url 'next_draw_time_api' %}");
    const data = await response.json();

    if (data.next_draw_time_str) {
      if (data.next_draw_time_str !== nextDrawTimeStr) {
        // It changed → show black screen and reload ONCE
        showBlackScreen();
        setTimeout(() => location.reload(), 2000);
        // STOP here! Don't update local variable (so after reload it's correct)
        return;
      }

      // Only update countdown if no change
      updateCountdown(data.total_seconds);
    }
  } catch (error) {
    console.error("Polling error:", error);
  }
}

setInterval(pollNextDrawTime, 5000); -->
</script>
</body>
</html>
